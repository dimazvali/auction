
doctype html
html
  head
    title auction
    script(src='https://telegram.org/js/telegram-web-app.js')

    meta(name='viewport' content='width=device-width, initial-scale=1.0,user-scalable=no')
    meta(name='description' content='–ü–æ–ø—Ä–æ–±—É–π—Ç–µ ‚Äî –≤–∞–º –ø–æ–Ω—Ä–∞–≤–∏—Ç—Å—è.')

    link(rel='stylesheet', href='/stylesheets/auction/app2.css')
    link(rel="preconnect", href="https://fonts.googleapis.com")
    link(rel="preconnect", href="https://fonts.gstatic.com")
    link(rel="stylesheet", href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap")

    
    script(src='/javascripts/knockout.js')
    script(type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js")
    script(type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js")
    script(type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js")
    script(type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js")
    script(src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.js')
    
    script!=`let botLink="${botLink}"`
    script!=`let translations=${JSON.stringify(translations)}`
    script!=`let lang="${lang}"`
    script!=`intention=${start ? `"${start}"` : false }`
    
    script(src='/javascripts/common.js')
    script(src='/javascripts/appCommon.js')
    script(type="module" src='/javascripts/auction/classes.js')
    
    script!=`${start?`let start="${start}"`:'let start=null'}`
  body#b
    script!=`let authNeeded=${authNeeded}`
    .popup.hidden
    .popup.hidden(data-bind="hidden:active()!='refs',attr:{shown:active()!='profile',class:active()!='refs'?`hidden`:`reg`}")
        div
            .flexSpread.h64
                div.h36.box2
                    span.ton.score(data-bind="html:`${tonBalance().toFixed(2)}`, event:{click:()=>showTransactions()}")
                div.flex
                    div.h36.box2.radiant
                        img(onclick="showFaq(`faq`)" src="/images/auction/faq.svg", alt="")
                    img.ava2(data-bind="attr:{src:avatar}")
            .section
                h3 –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
                .grid2
                    .box2.big
                        p.t –†–µ—Ñ–µ—Ä–∞–ª–æ–≤
                        p.score(data-bind="text:refs().length")
                    .box2.big
                        p.t –ò—Ö —Å—Ç–∞–≤–æ–∫
                        p.score(data-bind="text:refTonStakes")
                .box2.big
                    p.t –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ
                        p.ton.score(data-bind="text:refTonScore().toFixed(2)")
                .box2.big.vector
                    p.blue.t –î–æ—Å—Ç—É–ø–Ω–æ –∫ –≤—ã–≤–æ–¥—É
                        p.ton.score(data-bind="text:refTonScore().toFixed(2)")
            .section
                h3 –í–∞—à–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã:
                table
                    thead
                        tr
                            th –†–µ—Ñ–µ—Ä–∞–ª
                            th –°—Ç–∞–≤–∫–∏
                            th –î–æ—Ö–æ–¥
                    tbody(data-bind="foreach:refs")
                        tr
                            td(data-bind="text:username")
                            td.ton(data-bind="text:Math.floor(Math.random()*10)")
                            td.ton(data-bind="text:Math.floor(Math.random()*10)")
            .section
                h3 –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã
                table.ref(data-bind="foreach:refFaqs")
                    tr(data-bind="attr:{class:closed()?`down`:`up`}")
                        td.score.q(data-bind="text:name, event:{click:()=>toggle()}")
                    tr(data-bind="attr:{class:closed()?`hidden`:`reg`}") 
                        td(data-bind="hidden:closed(), text: description")


    .popup.hidden(data-bind="hidden:active()!='profile',attr:{shown:active()!='profile',class:active()!='profile'?`hidden`:`reg`}")
        div
            //- button.thin(onclick="showFaq(`faq`)") help
            .flexSpread.h64
                div.h36.box2
                    span.ton.score(data-bind="html:`${tonBalance().toFixed(2)}`, event:{click:()=>showTransactions()}")
                div.flex
                    div.h36.box2.radiant
                        img(onclick="showFaq(`faq`)" src="/images/auction/faq.svg", alt="")
                    img.ava2(data-bind="attr:{src:avatar}")
            .modal(data-bind="attr:{class:transactionsOpen()?'modal':'hidden'}")
                h2(data-bind="event:{click:()=>showTransactions()}") –ò—Å—Ç–æ—Ä–∏—è
                .vScroll
                    table
                        thead
                            tr
                                th –î–µ–π—Å—Ç–≤–∏–µ
                                th –°—É–º–º–∞
                                th –î–∞—Ç–∞
                        tbody(data-bind="foreach:transactions")
                            tr
                                td(data-bind="text:comment")
                                td.ton(data-bind="text:amount.toFixed(2)")
                                td(data-bind="text:date")
            .section
                h3 –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç–∞–≤–æ–∫
                .grid2
                    .box2.big
                        p.t –°—É–º–º–∞ —Å—Ç–∞–≤–æ–∫
                        p.ton.score(data-bind="text:totalStaked().toFixed(2)")
                    .box2.big
                        p.t –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞–≤–æ–∫
                        p.score(data-bind="text:stakes")
                .box2.big.vector
                    p.blue.t –°—É–º–º–∞ –≤—ã–∏–≥—Ä—ã—à–µ–π
                        p.ton.score(data-bind="text:total().toFixed(2)")

            //- .flexLeft
            //-     div.avaContainer
            //-         img.ava(data-bind="attr:{src:avatar}")
            //-         //- 
            //-         span.bal(data-bind="html:`üíé ${tonBalance()}`")
            //-     p.center(data-bind="html:`—Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ ${refs()}`")
            //-     p.center(data-bind="html:`—Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:<br>${botLink}?ref=${userId()}`, event:{click:()=>copyRef()}")
                    
            //-     h3(data-bind="text:username")
            //- button(data-bind="event:{click:()=>$root.requestPaymentTon(10)}") üíé –ü–æ–ø–æ–ª–Ω–∏—Ç—å –¢–æ–Ω
            //- button#ton-connect
            //- #sendMe
            //- button(data-bind="event:{click:()=>$root.requestPayment(10)}") –ü–æ–ø–æ–ª–Ω–∏—Ç—å —Å—á–µ—Ç
            //- div.mTop(data-bind="foreach:transactions")
            //-     div.transaction(data-bind="event:{click:()=>$root.showAlert(`${date}\n\n${comment}: ‚≠ê${amount}`)}")
            //-         span.info(data-bind="text:comment")
            //-         span.info.sum(data-bind="text:amount")
    .popup.reg(data-bind="hidden:active()!='lobby',attr:{shown:active()!='lobby',class:active()!='lobby'?`hidden`:`reg`}")
        div
            .flexSpread.h64
                div.h36.box2
                    span.ton.score(data-bind="html:`${tonBalance().toFixed(2)}`, event:{click:()=>showTransactions()}")
                div.flex
                    div.h36.box2.radiant
                        img(onclick="showFaq(`faq`)" src="/images/auction/faq.svg", alt="")
                    img.ava2(data-bind="attr:{src:avatar}")
            div(data-bind="foreach:iterations")
                .container.auction(data-bind="shown:active, attr:{'data-active':active,'data-ton':ton}")
                    .flex.s
                        div.auctionId(data-bind="text:id.slice(0,6)")
                        .flex.topCenterLine
                            div.star(data-bind="attr:{'data-on':(stakeHolder() == $root.hash())}")
                            div.crown(data-bind="attr:{'data-on':(stakeHolder() == $root.hash())}")
                        div.history(data-bind="event:{click:()=>showHistory()}")
                    .flex.s
                        .winner(data-bind="text:stakeHolder() == $root.hash()? '–≤—ã' : (stakeHolderId()||'‚Äî')")
                        div.pool(data-bind="text: stake().toFixed(2)")
                        .countDown(data-bind="text:left")
                    button.stakeButton(data-bind=`attr:{disabled:stakeHolder()==$parent.hash()},click:$root.stake,text:stakeHolder()==$parent.hash()?"${translations.lead[lang]}":'${translations.bet[lang]} ('+base()+')'`)
    .popup(data-bind="hidden:active()!='current',attr:{shown:active()!='current',class:active()!='current'?`hidden`:`reg`}")
    
    #footer.grid
        #lobby(data-bind="event:{click:()=>sactive('lobby')}, attr:{'data-chosen':active()=='lobby'?true:false}")
            img(src="/images/auction/star_off.svg")
            //- span!=translations.auctions[lang]
        #wallet
            img(src="/images/auction/wallet_off.svg")
            //- span –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
        #refs(data-bind="event:{click:()=>sactive('refs')}")
            img(src="/images/auction/refs_off.svg")
            //- span —Ä–µ—Ñ–µ—Ä–∞–ª—ã
        #profile(data-bind="event:{click:()=>sactive('profile')}")
            img(src="/images/auction/profile_off.svg")
            //- span –ø—Ä–æ—Ñ–∏–ª—å
        
                
  script(type="module" src='/javascripts/auction/app2.js')
