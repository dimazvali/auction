
doctype html
html
  head
    title auction
    script(src='https://telegram.org/js/telegram-web-app.js')

    meta(name='viewport' content='width=device-width, initial-scale=1.0,user-scalable=no')
    meta(name='description' content='Попробуйте — вам понравится.')

    link(rel='stylesheet', href='/stylesheets/auction/app2.css')
    link(rel="preconnect", href="https://fonts.googleapis.com")
    link(rel="preconnect", href="https://fonts.gstatic.com")
    link(rel="stylesheet", href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap")

    
    script(src='/javascripts/knockout.js')
    script(type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js")
    script(type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js")
    script(type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js")
    script(type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js")
    script(src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.js')
    
    script!=`let botLink="${botLink}"`
    script!=`let translations=${JSON.stringify(translations)}`
    script!=`let lang="${lang}"`
    script!=`intention=${start ? `"${start}"` : false }`
    
    script(src='/javascripts/common.js')
    script(src='/javascripts/appCommon.js')
    script(type="module" src='/javascripts/auction/classes.js')
    
    script!=`${start?`let start="${start}"`:'let start=null'}`
  body#b
    - let wallet ="UQAbMidsunh9esQXj1bd7zXNS-lamkN77cdqaF-GEdJ5W9yj";
    script!=`let authNeeded=${authNeeded}`
    div(data-bind="foreach:faqs")
       .popup.hidden(data-bind="attr:{class:closed()?'hidden':'popup reg'}")
            div
                .section
                    img.ico.big(data-bind="attr:{src:icon}")
                    h3(data-bind="text:name")
                    div.small(data-bind="text:description")
                    button.thin(data-bind="event:{click:()=>toggle()}") Закрыть
    .popup.hidden(data-bind="hidden:active()!='faq',attr:{class:active()!='faq'?'hidden':'reg'}")
        div
            include header
            .section
                h3 FAQ
                .grid2(data-bind="foreach:faqs")
                    .box2.big(data-bind="event:{click:()=>toggle()}")
                        img.ico(data-bind="attr:{src:icon}")
                        p.tag.timing(data-bind="text:timing")
                        p.score(data-bind="text:name")
    .popup.hidden(data-bind="hidden:active()!='refs',attr:{shown:active()!='profile',class:active()!='refs'?`hidden`:`reg`}")
        div
            include header
            .section
                h3 Реферальная ссылка
                .box2.line
                    span.ws(data-bind="text:`${botLink}?start=ref_${userId()}`, event:{click:()=>copyRef()}") 
                    .copyButton(data-bind="event:{click:()=>copyRef()}")
                .grid2
                    .box2.big
                        p.t Рефералов
                        p.score(data-bind="text:refs().length")
                    .box2.big
                        p.t Их ставок
                        p.score(data-bind="text:totalRefStakesTon")
                .box2.big
                    p.t Всего заработано
                    p.ton.score(data-bind="text:totalRefScoreTon().toFixed(2)")
                .box2.big.vector
                    p.blue.t Доступно к выводу
                    p.ton.score(data-bind="text:curRefScoreTon().toFixed(2)")
                    button.fr(data-bind="attr:{disabled:curRefScoreTon()?false:true},event:{click:()=>requestWithDraw('ref')}") Получить
            .section
                h3 Ваши рефералы:
                table
                    thead
                        tr
                            th Реферал
                            th Ставки
                            th Доход
                    tbody(data-bind="foreach:refs")
                        tr
                            td(data-bind="text:'@'+username()")
                            td(data-bind="text:totalStakesTon")
                            td.ton(data-bind="text:score().toFixed(2)")
                            //- td.ton(data-bind="text:Math.floor(Math.random()*10)")
                            //- td.ton(data-bind="text:Math.floor(Math.random()*10)")
            .section
                h3 Часто задаваемые вопросы
                table.ref(data-bind="foreach:refFaqs")
                    tr(data-bind="attr:{class:closed()?`down`:`up`}")
                        td.score.q(data-bind="text:name, event:{click:()=>toggle()}")
                    tr(data-bind="attr:{class:closed()?`hidden`:`reg`}") 
                        td(data-bind="hidden:closed(), text: description")
    .popup.hidden(data-bind="hidden:active()!='profile',attr:{shown:active()!='profile',class:active()!='profile'?`hidden`:`reg`}")
        div
            //- button.thin(onclick="showFaq(`faq`)") help
            include header
            //- .modal(data-bind="attr:{class:transactionsOpen()?'modal':'hidden'}")
            //-     h2(data-bind="event:{click:()=>showTransactions()}") История
            //-     .vScroll
            //-         table
            //-             thead
            //-                 tr
            //-                     th Действие
            //-                     th Сумма
            //-                     th Дата
            //-             tbody(data-bind="foreach:transactions")
            //-                 tr
            //-                     td(data-bind="text:comment")
            //-                     td.ton(data-bind="text:amount.toFixed(2)")
            //-                     td(data-bind="text:date")
            .section
                h3 Статистика ставок
                .grid2
                    .box2.big
                        p.t Сумма ставок
                        p.ton.score(data-bind="text:totalStakedTon().toFixed(2)")
                    .box2.big
                        p.t Количество ставок
                        p.score(data-bind="text:totalStakesTon")
                .box2.big.vector
                    p.blue.t Сумма выигрышей
                        p.ton.score(data-bind="text:totalScoreTon().toFixed(2)")
    .popup.hidden(data-bind="hidden:active()!='before',attr:{shown:active()!='before',class:active()!='before'?`hidden`:`reg`}")
        div
            h3 История
            div(data-bind="foreach:archive")
                div.box2.big
                    .flexSpread
                        .div
                            p.info(data-bind="text:date")
                            p.small(data-bind="text:id.slice(0,6)")
                            .flex
                                span.small.tag.winner(data-bind="text:stakeHolder() == $root.hash()? 'Вы' : (stakeHolderId()||'—')")
                                span.small.tag.ton(data-bind="text:stake().toFixed(2)")
                                span.small.tag(data-bind="text:time")
                        .div.flex
                            div.mRight.round.history(data-bind="event:{click:()=>showHistory()}")
                            div.round.share(data-bind="event:{click:()=>showShare()}")
    .popup.hidden(data-bind="hidden:active()!='lobby',attr:{shown:active()!='lobby',class:active()!='lobby'?`hidden`:`reg`}")
        div
            include lobbyHeader
            div.section(data-bind="foreach:iterations")
                .container.auction(data-bind="shown:active, attr:{'data-active':active,'data-ton':ton}")
                    .flex.s
                        div.auctionId(data-bind="text:id.slice(0,6)")
                        .flex.topCenterLine
                            div.star(data-bind="attr:{'data-on':userActive()}")
                            div.crown(data-bind="attr:{'data-on':(stakeHolder() == $root.hash())}")
                        div.round.history(data-bind="event:{click:()=>showHistory()}")
                    .flex.s
                        .winner(data-bind="text:stakeHolder() == $root.hash()? 'Вы' : (stakeHolderId()||'—')")
                        div.pool(data-bind="text: stake().toFixed(2)")
                        .countDown(data-bind="text:left")
                    button.stakeButton(data-bind=`attr:{disabled:stakeHolder()==$parent.hash()},click:$root.stake,text:stakeHolder()==$parent.hash()?"${translations.lead[lang]}":'${translations.bet[lang]} ('+base()+')'`)
    .popup.hidden(data-bind="hidden:active()!='wallet',attr:{shown:active()!='wallet',class:active()!='wallet'?`hidden`:`reg`}")
        div
            include header 
            .section.container.grid3
                span.active(data-bind="event:{click:()=>swalletActive('deposit')}, attr:{class:walletActive()=='deposit'?'active':'reg'}") Депозит
                span(data-bind="event:{click:()=>swalletActive('out')}, attr:{class:walletActive()=='out'?'active':'reg'}") Вывод
                span(data-bind="event:{click:()=>swalletActive('transactions')}, attr:{class:walletActive()=='transactions'?'active':'reg'}") Транзакции
            .container(data-bind="attr:{class:walletActive()=='deposit'?'reg':'hidden'}")
                h3 Ручное пополнение
                p.t.small Адрес для пополнения
                .box2.line
                    span.pre.ws(data-bind="event:{click:()=>copy('"+wallet+"')}")!=wallet
                    .copyButton(data-bind="event:{click:()=>copy('"+wallet+"')}")
                p.t.small Memo
                .box2.line
                    span.pre.ws(data-bind="text:hash, event:{click:()=>copy(hash())}") 
                    .copyButton(data-bind="event:{click:()=>copy(hash())}")
            .container(data-bind="attr:{class:walletActive()=='out'?'reg':'hidden'}")
                h3 Вывод средств
                p.t.small Адрес вашего кошелька
                .box2.line
                    input.pre.ws(data-bind="value:userwallet" name="wallet")
                p.t.small Memo
                .box2.line
                    input.pre.ws(data-bind="value:usermemo" name="memo")
                p.t.small Сумма вывода
                .box2.line
                    input.pre.ws(data-bind="attr{placeholder:curScoreTon().toFixed(2)}, value:toWithDraw" type="number" step="0.01" min="0.5" name="withdrawal")
                p.info.topless!=`Минимальная сумма: <span class="ton">0,5</span>.` 
                br
                button.sent(data-bind="attr:{disabled:withdrawalInProcess()?true:false}, event:{click:()=>requestWithDrawTon()}") Вывод
                .section(data-bind="attr:{class:requests().length?`reg section`:`hidden`}")
                    h3 Переводы на рассмотрении
                    div(data-bind="foreach:requests")    
                        div.box2.big
                            p(data-bind="text:date")
                            p.score.ton(data-bind="text:amount")                    

            .container(data-bind="attr:{class:walletActive()=='transactions'?'reg':'hidden'}")
                h3 История
                .vScroll
                    table
                        thead
                            tr
                                th Действие
                                th Сумма
                                th Дата
                        tbody(data-bind="foreach:transactions")
                            tr.appear
                                td(data-bind="text:comment")
                                td.ton(data-bind="text:amount.toFixed(2)")
                                td(data-bind="text:date")
    #footer.grid
        #lobby(data-bind="event:{click:()=>sactive('lobby')}, attr:{'data-chosen':active()=='lobby'?true:false}")
            img.navbar(src="/images/auction/star_on.svg")
            //- span!=translations.auctions[lang]
        #wallet(data-bind="event:{click:()=>sactive('wallet')}, attr:{'data-chosen':active()=='wallet'?true:false}")
            img.navbar(src="/images/auction/wallet_on.svg")
            //- span пополнение
        #refs(data-bind="event:{click:()=>sactive('refs')}, attr:{'data-chosen':active()=='refs'?true:false}")
            img.navbar(src="/images/auction/refs_on.svg")
            //- span рефералы
        #profile(data-bind="event:{click:()=>sactive('profile')}, attr:{'data-chosen':active()=='profile'?true:false}")
            img.navbar(src="/images/auction/profile_on.svg")
            //- span профиль
        
                
  script(type="module" src='/javascripts/auction/app2.js')
