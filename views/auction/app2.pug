
doctype html
html
  head
    title auction
    script(src='https://telegram.org/js/telegram-web-app.js')

    meta(name='viewport' content='width=device-width, initial-scale=1.0,user-scalable=no')
    meta(name='description' content='Попробуйте — вам понравится.')

    link(rel='stylesheet', href='/stylesheets/auction/app2.css')
    link(rel="preconnect", href="https://fonts.googleapis.com")
    link(rel="preconnect", href="https://fonts.gstatic.com")
    link(rel="stylesheet", href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap")

    
    script(src='/javascripts/knockout.js')
    script(type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js")
    script(type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js")
    script(type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js")
    script(type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js")
    script(src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.20.0/axios.js')
    
    script!=`let botLink="${botLink}"`
    script!=`let translations=${JSON.stringify(translations)}`
    script!=`let lang="${lang}"`
    script!=`intention=${start ? `"${start}"` : false }`
    
    script(src='/javascripts/common.js')
    script(src='/javascripts/appCommon.js')
    script(type="module" src='/javascripts/auction/classes.js')
    
    script!=`${start?`let start="${start}"`:'let start=null'}`
  body#b
    script!=`let authNeeded=${authNeeded}`
    div(data-bind="foreach:faqs")
       .popup.hidden(data-bind="attr:{class:closed()?'hidden':'popup reg'}")
            div
                .section
                    img.ico.big(data-bind="attr:{src:icon}")
                    h3(data-bind="text:name")
                    div.small(data-bind="text:description")
                    button.thin(data-bind="event:{click:()=>toggle()}") Закрыть
    .popup.hidden(data-bind="hidden:active()!='faq',attr:{class:active()!='faq'?'hidden':'reg'}")
        div
            include header
            .section
                h3 FAQ
                .grid2(data-bind="foreach:faqs")
                    .box2.big(data-bind="event:{click:()=>toggle()}")
                        img.ico(data-bind="attr:{src:icon}")
                        p.timing(data-bind="text:timing")
                        p.score(data-bind="text:name")
    .popup.hidden(data-bind="hidden:active()!='refs',attr:{shown:active()!='profile',class:active()!='refs'?`hidden`:`reg`}")
        div
            include header
            .section
                h3 Реферальная ссылка
                .box2.line
                    span.ws(data-bind="text:`${botLink}?start=ref_${userId()}`, event:{click:()=>copyRef()}") 
                    .copyButton(data-bind="event:{click:()=>copyRef()}")
                .grid2
                    .box2.big
                        p.t Рефералов
                        p.score(data-bind="text:refs().length")
                    .box2.big
                        p.t Их ставок
                        p.score(data-bind="text:totalRefStakesTon")
                .box2.big
                    p.t Всего заработано
                    p.ton.score(data-bind="text:totalRefScoreTon().toFixed(2)")
                .box2.big.vector
                    p.blue.t Доступно к выводу
                    p.ton.score(data-bind="text:curRefScoreTon().toFixed(2)")
                    button.fr(data-bind="attr:{disabled:curRefScoreTon()?false:true},event:{click:()=>requestWithDraw('ref')}") Получить
            .section
                h3 Ваши рефералы:
                table
                    thead
                        tr
                            th Реферал
                            th Ставки
                            th Доход
                    tbody(data-bind="foreach:refs")
                        tr
                            td(data-bind="text:'@'+username()")
                            td(data-bind="text:totalStakesTon")
                            td.ton(data-bind="text:score().toFixed(2)")
                            //- td.ton(data-bind="text:Math.floor(Math.random()*10)")
                            //- td.ton(data-bind="text:Math.floor(Math.random()*10)")
            .section
                h3 Часто задаваемые вопросы
                table.ref(data-bind="foreach:refFaqs")
                    tr(data-bind="attr:{class:closed()?`down`:`up`}")
                        td.score.q(data-bind="text:name, event:{click:()=>toggle()}")
                    tr(data-bind="attr:{class:closed()?`hidden`:`reg`}") 
                        td(data-bind="hidden:closed(), text: description")


    .popup.hidden(data-bind="hidden:active()!='profile',attr:{shown:active()!='profile',class:active()!='profile'?`hidden`:`reg`}")
        div
            //- button.thin(onclick="showFaq(`faq`)") help
            include header
            .modal(data-bind="attr:{class:transactionsOpen()?'modal':'hidden'}")
                h2(data-bind="event:{click:()=>showTransactions()}") История
                .vScroll
                    table
                        thead
                            tr
                                th Действие
                                th Сумма
                                th Дата
                        tbody(data-bind="foreach:transactions")
                            tr
                                td(data-bind="text:comment")
                                td.ton(data-bind="text:amount.toFixed(2)")
                                td(data-bind="text:date")
            .section
                h3 Статистика ставок
                .grid2
                    .box2.big
                        p.t Сумма ставок
                        p.ton.score(data-bind="text:totalStakedTon().toFixed(2)")
                    .box2.big
                        p.t Количество ставок
                        p.score(data-bind="text:totalStakesTon")
                .box2.big.vector
                    p.blue.t Сумма выигрышей
                        p.ton.score(data-bind="text:totalScoreTon().toFixed(2)")

    .popup.reg(data-bind="hidden:active()!='lobby',attr:{shown:active()!='lobby',class:active()!='lobby'?`hidden`:`reg`}")
        div
            include header
            div(data-bind="foreach:iterations")
                .container.auction(data-bind="shown:active, attr:{'data-active':active,'data-ton':ton}")
                    .flex.s
                        div.auctionId(data-bind="text:id.slice(0,6)")
                        .flex.topCenterLine
                            div.star(data-bind="attr:{'data-on':(stakeHolder() == $root.hash())}")
                            div.crown(data-bind="attr:{'data-on':(stakeHolder() == $root.hash())}")
                        div.history(data-bind="event:{click:()=>showHistory()}")
                    .flex.s
                        .winner(data-bind="text:stakeHolder() == $root.hash()? 'вы' : (stakeHolderId()||'—')")
                        div.pool(data-bind="text: stake().toFixed(2)")
                        .countDown(data-bind="text:left")
                    button.stakeButton(data-bind=`attr:{disabled:stakeHolder()==$parent.hash()},click:$root.stake,text:stakeHolder()==$parent.hash()?"${translations.lead[lang]}":'${translations.bet[lang]} ('+base()+')'`)
    .popup(data-bind="hidden:active()!='current',attr:{shown:active()!='current',class:active()!='current'?`hidden`:`reg`}")
    
    #footer.grid
        #lobby(data-bind="event:{click:()=>sactive('lobby')}, attr:{'data-chosen':active()=='lobby'?true:false}")
            img.navbar(src="/images/auction/star_on.svg")
            //- span!=translations.auctions[lang]
        #wallet
            img.navbar(src="/images/auction/wallet_on.svg")
            //- span пополнение
        #refs(data-bind="event:{click:()=>sactive('refs')}, attr:{'data-chosen':active()=='refs'?true:false}")
            img.navbar(src="/images/auction/refs_on.svg")
            //- span рефералы
        #profile(data-bind="event:{click:()=>sactive('profile')}, attr:{'data-chosen':active()=='profile'?true:false}")
            img.navbar(src="/images/auction/profile_on.svg")
            //- span профиль
        
                
  script(type="module" src='/javascripts/auction/app2.js')
